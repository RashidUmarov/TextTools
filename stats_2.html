<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>HTML Stats</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="sizer.css">
    <style>
        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .content {
            flex: 1 1 auto;
            overflow: auto;
        }

        #drop_zone {
            width: 300px;
            height: 100px;
            border: 3px dashed #cccccc;
            border-radius: 10px;
            text-align: center;
            color: #999999;
            font-family: sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 30px auto;
        }

        #drop_zone.hover {
            border-color: #333333;
            color: #333333;
            background-color: #f0f0f0;
        }

        #file_contents {
            width: 100%;
            height: 300px;
            margin: 0 auto 20px auto;
            padding: 10px;
            border: 1px solid #ddd;
            background: #fff;
            white-space: pre-wrap;
            font-family: monospace;
            overflow: auto;
            resize: vertical;
            box-sizing: border-box;
            border-radius: 8px;
        }

        #file_contents p,
        #file_contents p[style],
        #file_contents p[style*="text-align"],
        #file_contents p[style*="margin"],
        #file_contents p[style*="padding"] {
            margin: -2px 0 !important;
            padding: 0 !important;
            line-height: 1.4em !important;
        }

        #file_contents br {
            display: none;
        }

        #link_blocks {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            width: 100%;
            gap: 10px;
            margin-top: 20px;
        }

        .styled-block {
            background-color: #f6f6fb;
            border: 1px solid #c5c5da;
            color: #222;
            padding: 12px;
            border-radius: 8px;
            flex: 1 1 250px;
            min-width: 250px;
        }

        .btn-look {
            display: block;
            margin: 20px auto;
        }
    </style>
</head>
<body>
<div class="header">
    <div class="inner-header">
        <div class="logo-container">
            <h1>HTML Stats</h1>
        </div>
        <ul class="navigation">
            <a href="index.html">
                <li>Главная</li>
            </a>
            <a href="about.html">
                <li>Обо мне</li>
            </a>
            <a href="slider.html">
                <li>Слайдер</li>
            </a>
            <a href="svg.html">
                <li>SVG</li>
            </a>
            <a href="composer.html">
                <li>Composer</li>
            </a>
            <a href="link_dropper.html">
                <li>Dropper</li>
            </a>
            <a href="changer.html">
                <li>Changer</li>
            </a>
            <a href="code_blocks.html">
                <li>Blocks</li>
            </a>
            <a href="cleaner.html">
                <li>Cleaner</li>
            </a>
            <a href="contacts.html">
                <li>Обратная связь</li>
            </a>
        </ul>
    </div>
</div>
<div class="content">
    <div id="drop_zone">Перетащите сюда файл</div>
    <div id="file_contents">Здесь появится содержимое файла...</div>
    <div id="link_blocks"></div>
    <button id="reset_button" class="btn-look" style="display: none;">Сбросить</button>
</div>
<script>
    const dropZone = document.getElementById('drop_zone');
    const output = document.getElementById('file_contents');
    const resetButton = document.getElementById('reset_button');
    const linkBlocks = document.getElementById('link_blocks');

    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, e => e.preventDefault());
        document.body.addEventListener(eventName, e => e.preventDefault());
    });

    dropZone.addEventListener('dragover', () => {
        dropZone.classList.add('hover');
        dropZone.textContent = 'Отпустите файл';
    });

    dropZone.addEventListener('dragleave', () => {
        dropZone.classList.remove('hover');
        dropZone.textContent = 'Перетащите сюда файл';
    });

    dropZone.addEventListener('drop', e => {
        dropZone.classList.remove('hover');
        dropZone.textContent = 'Файл получен!';
        const files = e.dataTransfer.files;
        if (files.length === 0) {
            output.textContent = 'Нет файлов для загрузки.';
            return;
        }
        const file = files[0];
        if (!file.type.match('text.*')) {
            output.textContent = 'Пожалуйста, перетащите текстовый файл.';
            return;
        }

        const reader = new FileReader();
        reader.onload = event => {
            const html = event.target.result;
            const {title, description, announce} = extractArticleInfo(html);
            const links = extractCategoryLinks(html);

            output.innerHTML =
                `<h2>${title}</h2>` +
                `<div class="styled-block"><p>${description}</p></div>` +
                `<div><br>${announce}</div>`;

            renderCategoryBlocks('link_blocks', links);

            dropZone.textContent = 'Файл получен!';
            resetButton.style.display = 'block';
        };

        reader.onerror = () => {
            output.textContent = 'Ошибка при чтении файла.';
        };
        reader.readAsText(file, 'UTF-8');
    });

    resetButton.addEventListener('click', () => {
        output.textContent = 'Здесь появится содержимое файла...';
        dropZone.textContent = 'Перетащите сюда файл';
        resetButton.style.display = 'none';
        linkBlocks.innerHTML = '';
    });

    function extractArticleInfo(html) {
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        const title = doc.querySelector('title')?.textContent.trim() || 'Нет заголовка';
        const description = doc.querySelector('#description')?.textContent.trim() || 'Нет описания';
        const announce = doc.querySelector('#announce')?.innerHTML.trim() || 'Нет анонса';
        return {title, description, announce};
    }

    function extractCategoryLinks(html) {
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        const anchors = Array.from(doc.querySelectorAll('a[href]'));

        const articles = [];
        const code = [];
        const docs = [];
        const metatrader5 = [];

        anchors.forEach(a => {
            const href = a.getAttribute('href');
            if (/^\/?[a-z]{2}\/articles\//.test(href) || /\/articles\//.test(href)) {
                articles.push(href);
            } else if (/^\/?[a-z]{2}\/code\//.test(href) || /\/code\//.test(href)) {
                code.push(href);
            } else if (/^\/?[a-z]{2}\/docs\//.test(href) || /\/docs\//.test(href)) {
                docs.push(href);
            } else if (/https:\/\/www\.metatrader5\.com\/[a-z]{2}\//.test(href)) {
                metatrader5.push(href);
            }
        });

        return {articles, code, docs, metatrader5};
    }

    function renderCategoryBlocks(containerId, categories) {
        const container = document.getElementById(containerId);
        container.innerHTML = '';

        Object.entries(categories).forEach(([category, links]) => {
            const block = document.createElement('div');
            block.className = 'styled-block';

            const title = document.createElement('h3');
            title.textContent = `${capitalize(category)} (${links.length})`;
            block.appendChild(title);

            const list = document.createElement('ul');
            links.forEach(link => {
                const li = document.createElement('li');
                const a = document.createElement('a');
                a.href = link;
                a.textContent = link;
                a.target = '_blank';
                li.appendChild(a);
                list.appendChild(li);
            });
            block.appendChild(list);
            container.appendChild(block);
        });
    }

    function capitalize(word) {
        return word.charAt(0).toUpperCase() + word.slice(1);
    }
</script>
</body>
</html>
